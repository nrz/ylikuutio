name: build-and-test
on: [push]
jobs:
  build-and-test-on-ubuntu-gcc-native-compiler:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: sudo apt-get install -y cmake build-essential libx11-dev libgl1-mesa-dev libglu1-mesa-dev libpng-dev libsdl2-dev libxcursor-dev libxrandr-dev libxext-dev libxi-dev libxinerama-dev zlib1g-dev
      - run: gcc -v && g++ -v
      - run: mkdir build_native_gcc
      - run: echo "Running cmake for GCC native compiler"
      - run: CC=$(which gcc) CXX=$(which g++) cmake -Bbuild_native_gcc -DDO_UNIT_TESTS_WITH_GOOGLE_TEST=true
      - run: cmake --build build_native_gcc
      - run: cd build_native_gcc && ./unit_tests_with_googletest
  build-and-test-on-ubuntu-clang-native-compiler:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: sudo apt-get install -y cmake build-essential libx11-dev libgl1-mesa-dev libglu1-mesa-dev libpng-dev libsdl2-dev libxcursor-dev libxrandr-dev libxext-dev libxi-dev libxinerama-dev zlib1g-dev
      - run: clang -v && clang++ -v
      - run: mkdir build_native_clang
      - run: echo "Running cmake for Clang native compiler"
      - run: CC=$(which clang) CXX=$(which clang++) cmake -Bbuild_native_clang -DDO_UNIT_TESTS_WITH_GOOGLE_TEST=true
      - run: cmake --build build_native_clang
      - run: cd build_native_clang && ./unit_tests_with_googletest
  build-and-test-on-ubuntu-mingw-w64-gcc-crosscompiler:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: sudo apt-get install -y cmake build-essential libx11-dev libgl1-mesa-dev libglu1-mesa-dev libpng-dev libsdl2-dev libxcursor-dev libxrandr-dev libxext-dev libxi-dev libxinerama-dev zlib1g-dev g++-mingw-w64 gcc-mingw-w64 binutils-mingw-w64 libz-mingw-w64-dev
      - run: x86_64-w64-mingw32-gcc -v && x86_64-w64-mingw32-g++ -v
      - run: mkdir build_crosscompile_linux_to_windows_gcc
      - run: echo "Running cmake for MinGW-w64 GCC cross compiler"
      - run: cmake -Bbuild_crosscompile_linux_to_windows_gcc -DDIRECTX=FALSE -DCMAKE_TOOLCHAIN_FILE=w64.cmake
      - run: cmake --build build_crosscompile_linux_to_windows_gcc
